<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jhta.mapper.UserMapper">
	
	<!-- 
		List<User> searchUsers(@Param("col") String column,
						   @Param("val") Object value);
	-->
	<select id="searchUsers" resultType="kr.co.jhta.vo.User">
		select
			user_no as no
			, user_id as id
			, user_password as password
			, user_name as name
			, user_email as email
		from
			tb_users
		where #{col} = #{val}
	</select>
	
	<!-- 
		<resultMap />
			+ 데이터 조회결과를 지정된 객체와 매핑 시킨다.
			+ resultMap을 이용하면 별칭설정없이 컬럼의 값의 객체의 
			멤버변수에 대입할 수 있다.
	-->
	<resultMap id="userResultMap" type="kr.co.jhta.vo.User"> 
		<id 	property="no" 			column="USER_NO" />
		<result property="id" 			column="USER_ID" />
		<result property="password" 	column="USER_PASSWORD" />
		<result property="name" 		column="USER_NAME" />
		<result property="email" 		column="USER_EMAIL" />
		<result property="createdDate" 	column="USER_CREATED_DATE" />
		<result property="updatedDate" 	column="USER_UPDATED_DATE" />
	</resultMap>
	<!-- 
		void insertUser(@Param("user") User user);
	-->
	<insert id="insertUser">
    	<selectKey keyProperty="user.no"
    			   resultType="int" 
    			   order="BEFORE">
    		select tb_users_seq.nextval
    		from dual
    	</selectKey>
    	
      insert into tb_users
      (user_no, user_id
       , user_password
       , user_name
       , user_email)
      values
      (#{user.no}
       , #{user.id}
       , #{user.password}
       , #{user.name}
       , #{user.email})
   </insert>
   
   <!-- 
   		void insertUserRole(@Param("no") int userNo,
   							@Param("rolename") String rolename);
    -->
   <insert id="insertUserRole">
   		insert into tb_users_roles
   		(user_no, user_rolename)
   		values
   		(#{no}, #{rolename})
   </insert>
	
	<!-- 
		User getUserById(@Param("id") String id);
	-->
	<select id="getUserById" resultType="kr.co.jhta.vo.User">
		SELECT USER_NO as no
			, USER_ID as id
			, USER_PASSWORD as password
			, USER_NAME as name
			, USER_EMAIL as email 
			, USER_CREATED_DATE as createdDate
			, USER_UPDATED_DATE as updatedDate
		FROM TB_USERS
		WHERE USER_ID = #{id}
	</select>
	
	<select id="getUserByNo" resultMap="userResultMap">
		SELECT *
		FROM TB_USERS
		WHERE USER_NO = #{no}
	</select>
	
	<select id="getUsersByName" resultMap="userResultMap">
		SELECT *
		FROM TB_USERS
		WHERE USER_NAME = #{name}
	</select>
	
	<select id="getAllUsers" resultType="kr.co.jhta.vo.User">
		SELECT USER_NO as no
			, USER_ID as id
			, USER_PASSWORD as password
			, USER_NAME as name
			, USER_EMAIL as email
			, USER_CREATED_DATE as createdDate
			, USER_UPDATED_DATE as updatedDate
		FROM TB_USERS
	</select>
</mapper>